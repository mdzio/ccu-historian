<% 
import mdz.hc.DataPoint
import mdz.ccuhistorian.Database
try {
include 'skeleton-header.html'
def ctx=request.session.getAttribute('ctx')
if (!ctx.user.loggedIn) { 
	%><title>CCU-Historian: Anmeldung</title><% 
} else { 
	%><title>CCU-Historian: &Uuml;bersicht Datenpunkte</title>
	<script src="TableFilter/tablefilter_all_min.js" type="text/javascript"></script><% 
}
include 'skeleton-menu.html'
include 'skeleton-content.html'
if (!ctx.user.loggedIn) { 
	%><h1>Anmeldung</h1><%
	if (ctx.user.logInFailed) {
		%><p class="bad">Die Anmeldung ist fehlgeschlagen!</p><%
	}
	%><form method="post">
		<table>
			<tr>
				<th>Passwort</th>
				<td><input name="login_password" type="password" maxlength="30"/></td>
				<td><input name="login" type="submit" value=" Anmelden "></td>
			</tr>
		</table>
	</form><% 
} else { 
	%><h1>&Uuml;bersicht Datenpunkte</h1>
	<form action="analyze.html" method="get">	
	<table><tr><th>Aktion f&uuml;r die ausgew&auml;hlten Datenpunkte</th><td><input name="trend_set" type="submit" value=" Trend-Darstellung "></td></tr></table>
	<table id="datapoints">
		<thead><tr>
			<th>Schnittstelle</th>		
			<th>Kanal</th>
			<th>Parameter</th>
			<th style="width:3em">ID</th>
			<th>Aktueller Wert</th>
			<th>Einheit</th>
			<th>Zeitstempel</th>
			<th>Details</th>
			<th>Ausw.</th>
		</tr></thead><tbody><%
	database.dataPoints.findAll { !it.historyHidden }.each {
		def last=database.getLast(it)
		%><tr>
			<td><%=utils.escapeHtml(it.id.interfaceId)%></td>
			<td><%=utils.escapeHtml(it.attributes.displayName?:it.id.address)%></td>
			<td><%=utils.escapeHtml(it.id.identifier)%></td>
			<td class="number"><%=it.idx%></td>
			<td class="number"><%=utils.format(last?.value)%></td>
			<td><%=utils.escapeHtml(it.attributes.unit)%></td>
			<td><%=utils.format(last?.timestamp)%></td>
			<td><a href="dpdetails.html?i=<%=it.idx%>">Details</a></td>
			<td><input type="checkbox" name="i" value="<%=it.idx%>"<%=database.isOfTypeString(it)?' disabled="disabled"':''%>></td>
		</tr><%
		} 
	%></tbody></table>
	</form>
	<script type="text/javascript">  
		var tf_props={
				filters_row_index: 1,
				display_all_text: " [ Alle ]",
				col_0: "select",
				col_2: "select",
				col_5: "select",
				col_7: "none",
				col_8: "none",
				col_number_format: [null, null, null, "eu", "eu", null, null, null, null],
				on_keyup: true,  
                on_keyup_delay: 500,
				sort: true,
				sort_config: { sort_types: ["string", "string", "string", "eu", "eu", "string", "none", "none", "none"] }	
		}
		setFilterGrid("datapoints", tf_props);  
    </script><% 
}
include 'skeleton-end.html' 
} catch (Throwable t) { t.printStackTrace(out) }
%>